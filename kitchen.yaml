esphome:
  name: kitchen
  platform: ESP8266
  board: esp12e
  includes:
    - DoubleCurvedLight.h

wifi:
  ssid: !secret wifi-ssid
  password: !secret wifi-pwd

  # Enable fallback hotspot (captive portal) in case wifi connection fails
  ap:
    ssid: "Kitchen Fallback Hotspot"
    password: "h4GKBUNL9pAE"

captive_portal:

# Enable logging
logger:

# Enable Home Assistant API
#api:

mqtt:
  broker: mqtt.ak-online.be
  discovery: true

  on_message:
    topic: kitchen/light/kitchen_light/command/brightness
    qos: 0
    then:
      - logger.log:
          format: "incoming mqtt: %s, sent on as %f"
          args:
            - 'x.c_str()'
            - 'atof(x.c_str()) / 255.f'
      - light.control:
          id: "kitchen_light"
          brightness: !lambda return atof(x.c_str()) / 255.f;
          state: on

ota:

web_server:
  port: 80

i2c:
  sda: GPIO4
  scl: GPIO5
  scan: True

sensor:
    - platform: bme280
      temperature:
        name: "BME280 Temperature"
        oversampling: 16x
      pressure:
        name: "BME280 Pressure"
      humidity:
        name: "BME280 Humidity"
      address: 0x76
      update_interval: 30s


light:
  - platform: custom
    lambda: |-
      auto light_out = new DoubleCurvedLight(id(out_front), id(out_back));
      App.register_component(light_out);
      return {light_out};
    lights:
      - name: "Kitchen Light"
        id: "kitchen_light"
        default_transition_length: 0.3s


output:
  - platform: esp8266_pwm
    id: out_front
    pin: GPIO12
  - platform: esp8266_pwm
    id: out_back
    pin: GPIO14

